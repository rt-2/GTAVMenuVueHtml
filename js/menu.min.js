"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function getElementPosition(e){for(var t=0,n=0;e;){if("BODY"==e.tagName){var i=e.scrollLeft||document.documentElement.scrollLeft,r=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetLeft-i+e.clientLeft,n+=e.offsetTop-r+e.clientTop}else t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop;e=e.offsetParent}return{x:t,y:n}}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),PopupMenu=function(){function e(t,n,i,r){_classCallCheck(this,e),this.title=t||"",this.subtitle=n||"&nbsp;",this.limit=r||7,this.items=i,this.stats=null,this.slider=null,this.colorPicker=null,this.grid=null,this.style="blue",this.onItemChange=null,this.index=0}return _createClass(e,[{key:"currentItem",value:function(){return this.items[this.index]}},{key:"getStatByIndex",value:function(e){return this.stats[e]}},{key:"getStatByName",value:function(e){return this.stats.forEach(function(t){if(t.name===e)return t}),null}},{key:"setSliderValue",value:function(e){this.slider&&(this.slider.value=e)}},{key:"nextColorItem",value:function(){++this.colorPicker.index>this.colorPicker.colors.length-1&&(this.colorPicker.index=0)}},{key:"prevColorItem",value:function(){--this.colorPicker.index<0&&(this.colorPicker.index=this.colorPicker.colors.length-1)}},{key:"setGridXY",value:function(e,t){this.grid.x=e,this.grid.y=t}},{key:"getGridXY",value:function(){return{x:this.grid.x,y:this.grid.y}}},{key:"nextSelectionItem",value:function(){var e=this.currentItem();"[object Array]"===Object.prototype.toString.call(e.value)&&(++e.index>e.value.length-1&&(e.index=0),"function"==typeof e.onChange&&e.onChange(e.index,e.value[e.index]))}},{key:"prevSelectionItem",value:function(){var e=this.currentItem();"[object Array]"===Object.prototype.toString.call(e.value)&&(--e.index<0&&(e.index=e.value.length-1),"function"==typeof e.onChange&&e.onChange(e.index,e.value[e.index]))}},{key:"Stats",value:function(e){return this.stats=e,this}},{key:"Slider",value:function(e,t,n){return this.slider={name:e||"&nbsp;",units:t||"%",value:n||0},this}},{key:"ColorPicker",value:function(e,t){return this.colorPicker={name:e,colors:t,index:0},this}},{key:"XYGrid",value:function(e,t,n,i,r,u){return this.grid={x:e||0,y:t||0,top:n,bottom:i,left:r,right:u},this}},{key:"Style",value:function(e){return this.style=e||"",this}},{key:"ActiveItemChanged",value:function(e){return this.onItemChange=e,this}}]),e}(),MenuItem=function(){function e(t,n,i){_classCallCheck(this,e),this.key=t,this.value=n||null,this.help=i||null,this.submenu=null,this.style=null,this.action=null,this.visible=!0,this.index=0,this.onChange=null}return _createClass(e,[{key:"Click",value:function(e){return this.action=e,this}},{key:"Back",value:function(){return this.submenu=!0,this}},{key:"SelectionChanged",value:function(e){return this.onChange=e,this}},{key:"Style",value:function(e){return this.style=e,this}},{key:"Submenu",value:function(e){return this.submenu=e,this}}]),e}(),MenuStatItem=function e(t,n,i,r){_classCallCheck(this,e),this.name=t||"",this.value=n||0,this.levels=i||1,this.width=r||160};Vue.component("selection",{template:"#selection",props:{index:{type:Number,default:0},list:Array}}),Vue.component("slider",{template:"#slider",props:{name:String,units:String,value:{type:Number,default:0}}}),Vue.component("color-selector",{template:"#color-selector",props:{name:String,colors:Array,index:{type:Number,default:0}},methods:{isShowing:function(e){if(this.index>7){if(e<this.index-7)return!1;if(e>this.index)return!1}else if(e>7)return!1;return!0}}}),Vue.component("xygrid",{template:"#xygrid",props:{x:Number,y:Number,left:{type:String,default:"Left"},right:{type:String,default:"Right"},top:{type:String,default:"Top"},bottom:{type:String,default:"Bottom"}},computed:{realX:function(){return 130*this.x},realY:function(){return 130*this.y}}}),Vue.component("stage",{props:["levels","value","width"],template:"#stage",computed:{valueCount:function(){return null!=this.value?Math.ceil(this.value/100/(1/this.levels)):0}},methods:{computeValueWidth:function(e){return e==this.valueCount?(this.value-100/this.levels*(this.valueCount-1))/100*this.width-2:this.width/this.levels-2}},created:function(){this.$nextTick(function(){0===this.width&&(this.width=this.$vnode.elm.parentNode.offsetWidth-20)})}}),Vue.component("popup-menu",{template:"#popup-menu",props:{menu:Object},data:function(){return{currentMenu:this.menu,menuStack:[],help:null}},methods:{processClick:function(e){this.currentMenu.index===e?this.currentMenu.currentItem().submenu?!0===this.currentMenu.currentItem().submenu?this.returnBack():(this.menuStack.push(this.currentMenu),this.currentMenu=this.currentMenu.currentItem().submenu,this.currentMenu.index=0,this.calculateLimit()):"function"==typeof this.currentMenu.currentItem().action&&this.currentMenu.currentItem().action():this.currentMenu.index=e},returnBack:function(){this.menuStack.length>0&&(this.currentMenu=this.menuStack.pop())},calculateLimit:function(){var e=this.currentMenu.limit>this.currentMenu.items.length?this.currentMenu.items.length:this.currentMenu.limit;if(this.currentMenu.items.length>e)for(var t=0;t<this.currentMenu.items.length;t++)this.currentMenu.items[t].visible=t<e}},created:function(){var e=this;this.calculateLimit(),window.addEventListener("wheel",function(t){var n=t.deltaY||t.detail||t.wheelData;n>0?e.currentMenu.index++:n<0&&e.currentMenu.index--}),this.$nextTick(function(){if(0!==this.$vnode.elm.getElementsByClassName("xygrid").length){var t=this.$vnode.elm.getElementsByClassName("xygrid")[0].children[1],n=!1;t.addEventListener("mousedown",function(t){if(1===t.which){var i=getElementPosition(t.currentTarget),r=t.clientX-i.x,u=t.clientY-i.y;e.currentMenu.grid&&r<136&&u<136&&e.currentMenu.setGridXY(r/130,u/130),n=!0}}),window.addEventListener("mouseup",function(e){1===e.which&&(n=!1)}),t.addEventListener("mousemove",function(t){if(n){var i=getElementPosition(t.currentTarget),r=t.clientX-i.x,u=t.clientY-i.y;e.currentMenu.grid&&r<136&&u<136&&e.currentMenu.setGridXY(r/130,u/130)}})}}),window.addEventListener("contextmenu",function(t){t.preventDefault(),e.returnBack()}),window.addEventListener("keyup",function(t){return 38==t.keyCode?e.currentMenu.index--:40==t.keyCode?e.currentMenu.index++:13==t.keyCode?e.processClick(e.currentMenu.index):8==t.keyCode&&e.returnBack(),null!=e.currentMenu.currentItem()&&(37==t.keyCode?e.currentMenu.prevSelectionItem():39==t.keyCode&&e.currentMenu.nextSelectionItem()),e.currentMenu.colorPicker&&(37==t.keyCode?e.currentMenu.prevColorItem():39==t.keyCode&&e.currentMenu.nextColorItem()),!1})},watch:{"currentMenu.index":function(e,t){if(e>this.currentMenu.items.length-1){for(n=0;n<this.currentMenu.items.length;n++)this.currentMenu.items[n].visible=n<this.currentMenu.limit;this.currentMenu.index=0}else if(e<0){for(var n=0;n<this.currentMenu.items.length;n++)this.currentMenu.items[n].visible=this.currentMenu.items.length-n<=this.currentMenu.limit;this.currentMenu.index=this.currentMenu.items.length-1}else"function"==typeof this.currentMenu.onItemChange&&this.currentMenu.onItemChange(this.currentMenu.index),e>this.currentMenu.limit-1?this.currentMenu.items[e-this.currentMenu.limit].visible=!1:this.currentMenu.items.length-e>this.currentMenu.limit&&(this.currentMenu.items[e+this.currentMenu.limit].visible=!1),e<t&&!this.currentMenu.items[e].visible&&(this.currentMenu.items[t+this.currentMenu.limit-1].visible=!1),this.currentMenu.items[e].visible=!0,this.currentMenu.items[e].help?this.help=this.currentMenu.items[e].help:this.help=null}}});